{
  "project": "PJ:SHOKAN",
  "type": "rulebook",
  "meta": {
    "file_version": "2025-08-28T12-57-26Z",
    "schema_version": "1.0.0",
    "status": "rc",
    "created_at": "2025-08-28T12-57-26Z",
    "updated_at": "2025-08-28T12-57-26Z",
    "compat": {
      "from": "1.0.0"
    }
  },
  "decisions": {
    "lang": {
      "default": "ja",
      "inheritance_order": [
        "document",
        "scene",
        "child"
      ],
      "notes": "pov / b_roll / com_roll は親に依存（個別にはlangを持たない）"
    },
    "timestamps": {
      "format": "YYYY-MM-DDTHH-mm-ssZ",
      "targets": [
        "scene",
        "note"
      ],
      "fields": [
        "created_at",
        "updated_at"
      ],
      "inheritance": "none",
      "notes": "pov / b_roll / com_roll は親に依存（個別にはtimestampを持たない）"
    }
  },
  "policy": {
    "authority": {
      "file_name_is_source_of_truth": true,
      "json_meta_file_version_is_mirror": true
    },
    "file_naming": {
      "pattern": "PJ_SHOKAN_Rulebook_YYYY-MM-DDTHH-mm-ssZ.json",
      "example": "PJ_SHOKAN_Rulebook_2025-08-27T12-25-00Z.json",
      "note": "時刻のコロン(:)はハイフン(-)に置換（Windows互換）"
    },
    "naming_conventions": {
      "json_keys": "snake_case",
      "enum_tag_names": [
        "scene",
        "pov",
        "b_roll",
        "com_roll",
        "mynote",
        "safehold"
      ],
      "internal_reserved_keys_prefix": "_",
      "id_namespace_format": "_",
      "reserved_namespaces": [
        "scene",
        "char",
        "note"
      ],
      "id_regex": "^(scene|char|note)_[a-z0-9_]+$"
    },
    "references": {
      "single_ref_suffix": "_ref",
      "multi_refs_suffix": "_refs",
      "scene_ref_regex": "^scene_[a-z0-9_]+$",
      "character_ref_regex": "^char_[a-z0-9_]+$",
      "note_ref_regex": "^note_[a-z0-9_]+$"
    },
    "visibility_rules": {
      "mynote": {
        "export": "hidden",
        "char_index": "exclude"
      },
      "safehold": {
        "export": "hidden",
        "char_index": "exclude",
        "audit_log": true
      },
      "b_roll": {
        "export": "hidden",
        "char_index": "exclude",
        "scope": "SHOKAN-only-meta"
      },
      "com_roll": {
        "export": "hidden",
        "char_index": "exclude",
        "scope": "SHOKAN-only-meta"
      }
    },
    "redaction": {
      "placeholder": "[REDACTED]",
      "apply_to": [
        "safehold"
      ]
    },
    "public_release": {
      "source_of_truth": ".jtd（人間原本）",
      "ai_json_usage": "内部仕様調整と機械処理のみ。公開テキストの抽出には用いない。"
    }
  },
  "constraints": {
    "hierarchy": {
      "max_depth": 2,
      "top_level": [
        "scene",
        "mynote",
        "safehold"
      ],
      "scene_children": [
        "pov",
        "b_roll",
        "com_roll"
      ],
      "leaf_tags": [
        "pov",
        "b_roll",
        "com_roll"
      ],
      "notes_top_level_only": true,
      "no_cycles": true,
      "scene_must_have_child": true
    }
  },
  "validation": {
    "profiles": {
      "draft": {
        "unresolved_ref": "warn",
        "autofix_level": 1
      },
      "release": {
        "unresolved_ref": "error",
        "autofix_level": 1
      }
    },
    "exceptions": {
      "scopes": {
        "mynote": "warn",
        "safehold": "warn"
      }
    },
    "targets": {
      "scene_ref": [
        "prev_scene_ref",
        "next_scene_ref"
      ],
      "character_ref": [
        "lead_character_ref",
        "supporting_character_refs"
      ],
      "note_ref": [
        "*"
      ]
    }
  },
  "build_policy": {
    "insert_build_tag_in_body": false,
    "store_as_meta": true,
    "meta_fields": [
      "profile",
      "build_id",
      "validated",
      "issues",
      "generated_at",
      "review"
    ],
    "profile": {
      "default": "draft",
      "switch_to_release": {
        "conditions": {
          "unresolved_ref_zero": true,
          "human_review_required": true
        },
        "steps": [
          "build_meta.profile を 'release' に設定",
          "validation を release プロファイルで実行",
          "エラーが残存する場合はビルド失敗として中断（issues.errors>0）",
          "成功時は build_meta.generated_at（UTC）を記録"
        ]
      }
    },
    "review": {
      "required": true,
      "fields": [
        "reviewer",
        "method",
        "timestamp_utc",
        "notes"
      ],
      "method_options": [
        "PR-merge",
        "checklist-OK",
        "explicit-OK"
      ]
    }
  },
  "build_meta": {
    "profile": "draft",
    "build_id": "auto",
    "validated": false,
    "issues": {
      "errors": 0,
      "warnings": 0
    },
    "generated_at": null,
    "review": {
      "reviewer": null,
      "method": null,
      "timestamp_utc": null,
      "notes": null
    }
  },
  "schema_hints": {
    "file_version_regex": "^\\\\d{4}-\\\\d{2}-\\\\d{2}T\\\\d{2}-\\\\d{2}-\\\\d{2}Z$",
    "semver_regex": "^(0|[1-9]\\\\d*)\\\\.(0|[1-9]\\\\d*)\\\\.(0|[1-9]\\\\d*)(?:-[0-9A-Za-z.-]+)?(?:\\\\+[0-9A-Za-z.-]+)?$",
    "allow_additional_properties": true,
    "defs": [
      "ns_identifier",
      "scene_ref",
      "character_ref",
      "note_ref",
      "tag_name",
      "tag_def"
    ]
  },
  "quick_examples": {
    "tags_minimal": [
      {
        "tag_name": "scene",
        "id": "scene_001",
        "name": "ロビー冒頭",
        "created_at": "2025-08-28T12-57-26Z",
        "updated_at": "2025-08-28T12-57-26Z",
        "children": [
          {
            "tag_name": "pov",
            "id": "note_pov_ryo",
            "note": "涼視点の導入（lang/timestampは親sceneを継承）"
          },
          {
            "tag_name": "com_roll",
            "id": "com_auto_0001",
            "note": "AI解析：環境音識別（export hidden）"
          }
        ]
      },
      {
        "tag_name": "mynote",
        "id": "note_memo_0001",
        "note": "作者用：後で伏線整理",
        "created_at": "2025-08-28T12-57-26Z",
        "updated_at": "2025-08-28T12-57-26Z"
      }
    ],
    "links": {
      "prev_scene_ref": "scene_000",
      "next_scene_ref": "scene_002",
      "lead_character_ref": "char_miki_saeki"
    }
  },
  "notes": {
    "com_roll": {
      "purpose": "Copilot起源の解析メタ（Computational / Copilot Originated Meta）",
      "human_counterpart": "B-Roll（人間の演出用）と混同しないために分離",
      "body_tag_mapping": {
        "human": "#B-Roll: start/end -> b_roll",
        "ai": "#COM-Roll: start/end -> com_roll"
      }
    }
  }
}